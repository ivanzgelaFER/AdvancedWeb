<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LAB5_PWA</title>

        <link rel="stylesheet" href="./site.css" />
        <link rel="manifest" href="./manifest.json" />
    </head>

    <body>
        <div>
          <h1>Welcome on Intranet</h1>  
        </div>
        <div>
            <div>
                <h2>Preddiplomski studij završen!</h2>
                <h3>Ako želite upisati diplomski studij unesite podatke za upis</h3>
            </div>
            <h2>Upis na diplomski</h2>
            <div></div>
            <div><p>Uslikajte se za novu iksicu</p></div>
            <div>
                <div>
                    Popis slika za novu iksicu
                </div>
                <button class="intranet-btn">
                    <a href="/photo_studio.html">Odlazak u studio za fotografiranje</a>
                </button>
                <div>

                </div>
                <div id="snaps" class="iksica-imgs-container">
                    <template id="snapTemplate">
                      <div class="img-container-card">
                        <div>
                            <img class="img-container-card-img" src="tbd"/>
                            <div class="img-title">
                                <h3>title</h3>
                            </div>
                        </div>
                      </div>
                    </template>
                </div>
            </div>
        </div>
        <script>
            navigator.serviceWorker.register('./sw.js', {type: 'module'})
                .then(reg => console.log('SW registered!', reg))
                .catch(err => console.error('Error registering service worker', err));
            fetch("/snaps")
                .then((res) => {
                console.log("res", res)
                if (res.ok) {
                    res.json()
                    .then((data) => {
                    console.log("data", data)
                    data.files.forEach((fileName) => {
                        console.log("appending", fileName)
                        let snapsDiv = document.querySelector("#snaps");
                        let template = document.querySelector('#snapTemplate');
                        var clone = template.content.cloneNode(true);
                        let img = clone.querySelector("img");
                        img.src = "/uploads/" + fileName;
                        let title = clone.querySelector("h3");
                        title.textContent = fileName.substring(24).replaceAll("_", " ").replaceAll(".png", "");
                        snapsDiv.appendChild(clone);
                    });
                    })
                }
            }).catch(err => {
                console.log(err);
            })           
        </script>
    </body>
</html>
